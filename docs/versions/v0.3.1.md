# PenOS v0.3.1

Summary
- Kernel heap now supports freeing and block recycling via boundary tags and coalescing.

Architecture changes
- Introduced `heap_block_t` metadata with next/prev pointers.
- `kmalloc` searches/splits free blocks before growing the heap; `kfree` marks blocks free and merges neighbors while checking double frees.

Files touched
- `src/mem/heap.c`
- `docs/architecture.md`
- `docs/commits/feature-heap/2_heap_freelist.md`
- `CHANGELOG.md`, `VERSION`, `docs/versions/v0.3.1.md`

Lessons learned
- Even a simple freelist significantly reduces fragmentation and allows long-running services.
- Debug logging on allocator misuse is invaluable during early bring-up.

Next steps
- Consider returning unused pages to the PMM or layering slab allocators for fixed-size objects.
- Put the heap to work powering scheduler stacks and future filesystem buffers.
