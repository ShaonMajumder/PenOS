# PenOS v0.5.1

Summary
- Kernel heap now exposes usage stats and trims free space from the top, unmapping pages and returning frames to the PMM when the tail is entirely free.

Architecture changes
- Added `heap_bytes_in_use/free` helpers for diagnostics.
- Implemented `heap_trim` to walk the tail of the freelist, drop free blocks at the end, unmap the reclaimed virtual pages, and free their physical frames.

Files touched
- `include/mem/heap.h`
- `src/mem/heap.c`
- `docs/architecture.md`
- `docs/commits/feature-heap/3_heap_trim.md`
- `CHANGELOG.md`, `VERSION`, `docs/versions/v0.5.1.md`

Lessons learned
- Keeping the heap strictly monotonic in address space makes reclaiming tail pages straightforward.
- Publishing allocator stats helps shells/apps surface memory diagnostics without poking internals.

Next steps
- Surface heap stats via a shell command (`meminfo`) and integrate reclaim hooks with future per-task heaps.
- Extend trimming logic to consider large interior arenas or switch to a slab/arena mix for long-lived workloads.
